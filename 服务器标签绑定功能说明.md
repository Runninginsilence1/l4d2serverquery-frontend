# 服务器列表功能说明

## 功能概述

在服务器列表（TableView）中包含以下主要功能：
1. **标签绑定功能**：允许用户为每个服务器绑定多个标签，方便管理和分类服务器
2. **玩家数量过滤**：支持按在线玩家数量范围筛选服务器

## 前端实现

### 功能一：标签绑定

1. **标签列显示**
   - 在服务器列表中新增"标签"列
   - 显示该服务器已绑定的所有标签
   - 如果没有标签，显示"暂无标签"

2. **标签按钮**
   - 在操作列新增"标签"按钮（黄色warning样式）
   - 点击打开标签绑定对话框

3. **标签绑定对话框**
   - 显示所有可用的标签
   - 支持多选（复选框样式）
   - 自动勾选该服务器已绑定的标签
   - 点击"保存绑定"后更新绑定关系

### 功能二：玩家数量过滤

1. **玩家数量筛选器**
   - 在搜索栏中新增"在线玩家数"筛选器
   - 包含两个数字输入框：最小玩家数和最大玩家数
   - 输入范围：0-32
   - 支持单独设置最小值或最大值，也支持同时设置范围

2. **筛选逻辑**
   - 只设置最小值：查询在线玩家数 >= 最小值的服务器
   - 只设置最大值：查询在线玩家数 <= 最大值的服务器
   - 同时设置：查询在线玩家数在该范围内的服务器
   - 都为0或不设置：不进行玩家数量过滤

3. **重置按钮**
   - 新增"重置"按钮，一键清空所有筛选条件
   - 包括：搜索关键字、最小玩家数、最大玩家数

### 文件修改

#### 1. `/src/api/tag.js`
新增三个API函数：
- `bindTagsToServer(serverId, tagIds)` - 绑定标签到服务器
- `getServerTags(serverId)` - 获取服务器的标签
- `unbindTagFromServer(serverId, tagId)` - 解绑单个标签

#### 2. `/src/views/TableView.vue`
主要修改：

**状态变量**：
- `minPlayers` - 最小在线玩家数
- `maxPlayers` - 最大在线玩家数
- `bindTagDialogVisible` - 控制标签对话框显示
- `allTags` - 所有可用标签
- `selectedTags` - 当前选中的标签
- `currentServerId` - 当前操作的服务器ID
- `currentServerName` - 当前操作的服务器名称

**新增函数**：
- `openBindTagDialog()` - 打开绑定标签对话框
- `saveTagBinding()` - 保存标签绑定
- `resetFilters()` - 重置所有筛选条件

**修改函数**：
- `queryServerFuncV2()` - 修改为支持玩家数量过滤参数

**UI改动**：
- 搜索区域新增玩家数量筛选器（两个数字输入框）
- 新增"重置"按钮
- 新增"标签"列显示服务器标签
- 操作列宽度从320调整为400
- 新增"标签"按钮
- 新增标签绑定对话框

## 使用流程

### 玩家数量过滤流程

1. 用户在"在线玩家数"筛选器中输入数值
   - 输入最小玩家数（例如：2）
   - 输入最大玩家数（例如：6）
   - 或只输入其中一个
2. 点击"查询服务器"按钮
3. 系统调用 `/serverList/v2` 接口，传递 `minPlayers` 和/或 `maxPlayers` 参数
4. 后端返回符合条件的服务器列表
5. 前端显示筛选结果
6. 用户可点击"重置"按钮清空所有筛选条件

### 标签绑定流程

1. 用户点击服务器列表中的"标签"按钮
2. 系统打开对话框，加载所有可用标签和该服务器已绑定的标签
3. 用户勾选/取消勾选标签（支持多选）
4. 用户点击"保存绑定"按钮
5. 系统调用后端API保存绑定关系
6. 绑定成功后关闭对话框并刷新服务器列表
7. 服务器列表的"标签"列显示更新后的标签

### 数据流

#### 玩家数量过滤数据流
```
用户输入玩家数量范围
    ↓
点击"查询服务器"
    ↓
构建请求参数 {
  name: "搜索关键字",
  tags: [标签ID数组],
  minPlayers: 2,  // 可选
  maxPlayers: 6   // 可选
}
    ↓
调用 POST /serverList/v2
    ↓
后端过滤符合条件的服务器
    ↓
返回服务器列表（包含 tags 字段）
    ↓
前端显示筛选结果
```

#### 标签绑定数据流
```
用户点击"标签"按钮
    ↓
调用 getAllTags() 获取所有标签
    ↓
调用 getServerTags(serverId) 获取服务器当前标签
    ↓
显示对话框，勾选已绑定的标签
    ↓
用户修改选择
    ↓
点击"保存绑定"
    ↓
调用 bindTagsToServer(serverId, selectedTagIds)
    ↓
绑定成功，刷新服务器列表 queryServerFuncV2()
    ↓
服务器列表显示更新后的标签（从后端返回的 tags 字段）
```

## 界面说明

### 搜索区域
- **搜索框**：输入服务器名称关键字
- **在线玩家数筛选器**：
  - 标签文字"在线玩家数："
  - 最小玩家数输入框（0-32）
  - 分隔符"-"
  - 最大玩家数输入框（0-32）
- **查询服务器按钮**：执行查询
- **重置按钮**：清空所有筛选条件

### 服务器列表
- 新增"标签"列，位于"玩家数量"和"最后复制时间"之间
- 标签以Element Plus的`el-tag`组件展示
- 多个标签横向排列，自动换行

### 操作列
- 复制按钮（蓝色）
- 玩家按钮（灰色）
- **标签按钮（黄色）** - 新增
- 刷新按钮（绿色）
- 删除按钮（红色）

### 标签绑定对话框
- 对话框标题显示：🏷️ 绑定标签 - [服务器名称]
- 顶部有提示信息
- 标签以带边框的复选框形式展示，每行一个
- 底部有"取消"和"保存绑定"按钮

## 后端要求

详细的后端API设计请参考 `后端API参考-服务器标签绑定.md`

### 关键点

1. **修改 `/serverList/v2` 接口（已完成）**
   - 支持 `minPlayers` 和 `maxPlayers` 参数
   - 在返回的服务器对象中包含 `tags` 字段
   - 请求体示例：
   ```json
   {
     "name": "服务器名称",
     "tags": [1, 2],
     "minPlayers": 2,
     "maxPlayers": 6
   }
   ```
   - 响应示例：
   ```json
   [
     {
       "id": 24,
       "address": "106.54.61.52:25444",
       "serverName": "示例服务器",
       "onlinePlayers": 4,
       "maxPlayers": 8,
       "tags": [
         { "id": 1, "name": "高质量" },
         { "id": 2, "name": "活跃社区" }
       ]
     }
   ]
   ```

2. **实现标签绑定接口**
   - `POST /server/{serverId}/tags` - 绑定标签（传标签ID数组）
   - `GET /server/{serverId}/tags` - 获取服务器标签

3. **数据库设计**
   - 建议创建 `server_tag` 关联表
   - 添加唯一索引防止重复绑定

## 技术细节

### 前端技术栈
- Vue 3 Composition API
- Element Plus UI组件库
- TypeScript
- Axios (通过封装的 myrequest)

### 样式说明
- 标签按钮使用 `warning` 类型（黄色）
- 对话框宽度：600px
- 复选框使用 `border` 和 `size="large"` 样式
- 标签单元格使用 flexbox 布局，支持换行

### 错误处理
- 所有API调用都有 try-catch 错误处理
- 失败时显示 Element Plus 的错误消息
- 控制台输出详细错误信息便于调试

## 扩展建议

### 可能的优化方向

1. **批量绑定**
   - 支持选择多个服务器，批量绑定相同的标签

2. **标签过滤**
   - 在服务器列表顶部添加标签过滤器
   - 点击标签快速筛选对应的服务器

3. **标签统计**
   - 显示每个标签绑定了多少个服务器

4. **标签颜色**
   - 为不同标签设置不同的颜色
   - 在列表中以不同颜色展示

5. **快捷操作**
   - 在标签列直接点击标签快速解绑
   - 右键菜单快速绑定常用标签

## 使用示例

### 示例1：查询在线玩家数在2-6人的服务器
1. 在"最小"输入框输入：2
2. 在"最大"输入框输入：6
3. 点击"查询服务器"
4. 结果：显示所有在线玩家数在2-6人之间的服务器

### 示例2：查询至少有4人在线的服务器
1. 在"最小"输入框输入：4
2. "最大"输入框保持为0或不填
3. 点击"查询服务器"
4. 结果：显示所有在线玩家数≥4的服务器

### 示例3：组合筛选
1. 搜索框输入：某个服务器名称关键字
2. 选择标签（通过标签筛选器）
3. 设置最小玩家数：2
4. 设置最大玩家数：8
5. 点击"查询服务器"
6. 结果：显示符合所有条件的服务器

### 示例4：重置筛选
1. 点击"重置"按钮
2. 所有筛选条件清空：
   - 搜索关键字清空
   - 最小玩家数重置为0
   - 最大玩家数重置为0

## 常见问题

### Q: 玩家数量设置为0是什么意思？
A: 设置为0表示不对该项进行过滤。例如，最小值为0表示不限制最小值。

### Q: 可以只设置最小值或只设置最大值吗？
A: 可以。只设置最小值会返回玩家数≥该值的服务器；只设置最大值会返回玩家数≤该值的服务器。

### Q: 为什么绑定后看不到标签？
A: 请确保后端的 `/serverList/v2` 接口返回了 `tags` 字段。

### Q: 绑定标签失败怎么办？
A: 检查控制台错误信息，确认：
- 后端API是否正确实现
- 服务器ID和标签ID是否有效
- 是否有权限执行操作

### Q: 如何创建新标签？
A: 通过导航菜单进入"标签管理"页面，可以创建和管理标签。

### Q: 可以清空服务器的所有标签吗？
A: 可以，在标签绑定对话框中取消所有标签的勾选，点击保存即可。

### Q: 玩家数量筛选对后端性能有影响吗？
A: 筛选是在数据库层面进行的，性能影响很小。建议后端在 `onlinePlayers` 字段上建立索引以优化查询性能。
